datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id               Int     @id @default(autoincrement())
  name             String
  subname          String?
  categoryname     String?

  kcal             Float
  mainFats         Float
  mainProteins     Float
  mainCarb         Float
  mainWater        Float
  mainAsh          Float
  subSugar         Float?
  subFiber         Float?
  subStarch        Float?
  subTransfats     Float?
  vitamin_a        Float?
  beta_carotene    Float?
  alpha_carotene   Float?
  vitamin_e        Float?
  vitamin_k        Float?
  vitamin_c        Float?
  vitamin_b1       Float?
  vitamin_b3       Float?
  vitamin_b4       Float?
  vitamin_b5       Float?
  vitamin_b6       Float?
  vitamin_b9       Float?
  vitamin_b12      Float?
  vitamin_b2       Float?
  vitamin_d        Float?
  vitamin_d2       Float?
  vitamin_d3       Float?
  calcium          Float?
  fluoride         Float?
  iron             Float?
  magnesium        Float?
  phosphorus       Float?
  potassium        Float?
  sodium           Float?
  zinc             Float?
  copper           Float?
  manganese        Float?
  selenium         Float?

  wasteWeightValue Float   @default(1.0)
  wasteWeightDesc  String  @default("Продукт в чистом виде")

  isDeleted        Boolean @default(false)

  Measures         Measure[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([name, subname])
  @@map("products")
}

model Measure {
  id          Int     @id @default(autoincrement())
  productId   Int
  name        String
  value       Float
  desc        String
  product     Product @relation(fields: [productId], references: [id])
  DishMeasures DishMeasure[]

  @@map("measures")
}

model Dish {
  id              Int         @id @default(autoincrement())
  name            String      @unique
  categoryname    String?
  description     String?

  kcal            Float?
  mainFats        Float?
  mainProteins    Float?
  mainCarb        Float?
  mainWater       Float?
  mainAsh         Float?
  subSugar        Float?
  subFiber        Float?
  subStarch       Float?
  subTransfats    Float?
  vitamin_a       Float?
  beta_carotene   Float?
  alpha_carotene  Float?
  vitamin_e       Float?
  vitamin_k       Float?
  vitamin_c       Float?
  vitamin_b1      Float?
  vitamin_b3      Float?
  vitamin_b4      Float?
  vitamin_b5      Float?
  vitamin_b6      Float?
  vitamin_b9      Float?
  vitamin_b12     Float?
  vitamin_b2      Float?
  vitamin_d       Float?
  vitamin_d2      Float?
  vitamin_d3      Float?
  calcium         Float?
  fluoride        Float?
  iron            Float?
  magnesium       Float?
  phosphorus      Float?
  potassium       Float?
  sodium          Float?
  zinc            Float?
  copper          Float?
  manganese       Float?
  selenium        Float?

  weight          Float?

  isDeleted       Boolean @default(false)

  measures        DishMeasure[]
  RationDishes    RationDish[]
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model DishMeasure {
  id         Int      @id @default(autoincrement())
  dishId     Int
  measureId  Int
  value      Float
  dish       Dish     @relation(fields: [dishId], references: [id])
  measure    Measure  @relation(fields: [measureId], references: [id])

  @@map("dish_measures")
}

model Ration {
  id              Int             @id @default(autoincrement())
  name            String       
  description     String?
  userId          Int             @default(1)
  date            DateTime
  
  kcal            Float?
  mainFats        Float?
  mainProteins    Float?
  mainCarb        Float?
  mainWater       Float?
  mainAsh         Float?
  subSugar        Float?
  subFiber        Float?
  subStarch       Float?
  subTransfats    Float?
  vitamin_a       Float?
  beta_carotene   Float?
  alpha_carotene  Float?
  vitamin_e       Float?
  vitamin_k       Float?
  vitamin_c       Float?
  vitamin_b1      Float?
  vitamin_b3      Float?
  vitamin_b4      Float?
  vitamin_b5      Float?
  vitamin_b6      Float?
  vitamin_b9      Float?
  vitamin_b12     Float?
  vitamin_b2      Float?
  vitamin_d       Float?
  vitamin_d2      Float?
  vitamin_d3      Float?
  calcium         Float?
  fluoride        Float?
  iron            Float?
  magnesium       Float?
  phosphorus      Float?
  potassium       Float?
  sodium          Float?
  zinc            Float?
  copper          Float?
  manganese       Float?
  selenium        Float?

  isDeleted       Boolean         @default(false)
  dishes          RationDish[]
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  @@unique([name, description, date])
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
  SUPPER
}

model RationDish {
  id            Int         @id @default(autoincrement())
  RationId      Int
  dishId        Int
  value         Float
  mealType      MealType
  ration        Ration      @relation(fields: [RationId], references: [id])
  dish          Dish        @relation(fields: [dishId], references: [id])

  @@map("Ration_dishes")
}
